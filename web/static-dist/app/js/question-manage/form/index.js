!function(l){function t(t){for(var e,i,a=t[0],n=t[1],r=t[2],o=0,s=[];o<a.length;o++)i=a[o],Object.prototype.hasOwnProperty.call(c,i)&&c[i]&&s.push(c[i][0]),c[i]=0;for(e in n)Object.prototype.hasOwnProperty.call(n,e)&&(l[e]=n[e]);for(p&&p(t);s.length;)s.shift()();return d.push.apply(d,r||[]),u()}function u(){for(var t,e=0;e<d.length;e++){for(var i=d[e],a=!0,n=1;n<i.length;n++){var r=i[n];0!==c[r]&&(a=!1)}a&&(d.splice(e--,1),t=o(o.s=i[0]))}return t}var i={},c={238:0},d=[];function o(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return l[t].call(e.exports,e,e.exports,o),e.l=!0,e.exports}o.m=l,o.c=i,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(i,a,function(t){return e[t]}.bind(null,a));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/static-dist/";var e=window.webpackJsonp=window.webpackJsonp||[],a=e.push.bind(e);e.push=t,e=e.slice();for(var n=0;n<e.length;n++)t(e[n]);var p=a;d.push([702,0]),u()}({10:function(t,e){t.exports=jQuery},702:function(t,e,i){"use strict";i.r(e);var a=i(0),s=i.n(a),n=i(1),r=i.n(n),o=i(50),l=function(){function e(t){s()(this,e),this.$form=t,this.titleFieldId="question-stem-field",this.analysisFieldId="question-analysis-field",this.validator=null,this.titleEditorToolBarName="Minimal",this._init(),this.attachmentActions=new o.a(t)}return r()(e,[{key:"_init",value:function(){this._initEvent(),this._initValidate(),this._initSelect()}},{key:"_initEvent",value:function(){var e=this;this.$form.on("click","[data-role=submit]",function(t){return e.submitForm(t)})}},{key:"submitForm",value:function(t){var e=$(t.currentTarget).data("submission");this.$form.find("[name=submission]").val(e);this.validator.form()&&($(t.currentTarget).button("loading"),this.$form.submit())}},{key:"_initValidate",value:function(){var t=this.$form.validate({onkeyup:!1,rules:{difficulty:{required:!0},stem:{required:!0},score:{required:!0,number:!0,max:999,min:0,es_score:!0}},messages:{difficulty:Translator.trans("course.question.create.difficulty_required_error_hint")}});this.validator=t}},{key:"_initSelect",value:function(){$("#categoryId").select2({treeview:!0,dropdownAutoWidth:!0,treeviewInitState:"collapsed",placeholderOption:"first"})}},{key:"initTitleEditor",value:function(t){var e=$("#"+this.titleFieldId),i=CKEDITOR.replace(this.titleFieldId,{toolbar:this.titleEditorToolBarName,fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:e.data("imageUploadUrl"),height:e.height()});i.on("change",function(){e.val(i.getData()),t.form(),console.log(i.getData())}),i.on("blur",function(){e.val(i.getData()),t.form(),console.log(i.getData())})}},{key:"initAnalysisEditor",value:function(){var t=$("#"+this.analysisFieldId),e=CKEDITOR.replace(this.analysisFieldId,{toolbar:this.titleEditorToolBarName,fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:t.data("imageUploadUrl"),height:t.height()});e.on("change",function(){t.val(e.getData())})}},{key:"titleEditorToolBarName",set:function(t){this._titleEditorToolBarName=t},get:function(){return this._titleEditorToolBarName}}]),e}(),u=i(2),c=i.n(u),d=i(7),p=i.n(d),h=i(4),f=i.n(h),m=i(8),g=i.n(m),v=i(52),y=i.n(v),b=i(3),S=i.n(b);function k(a){return function(){var t,e=f()(a);if(function(){if("undefined"==typeof Reflect||!c.a)return;if(c.a.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(c()(Date,[],function(){})),1}catch(t){return}}()){var i=f()(this).constructor;t=c()(e,arguments,i)}else t=e.apply(this,arguments);return p()(this,t)}}var D=function(t){g()(a,t);var i=k(a);function a(t){var e;return s()(this,a),(e=i.call(this,t)).state={datas:e.props.datas},e.editor=null,e.editorBody=null,e.editorHtml=null,e}return r()(a,[{key:"componentDidMount",value:function(){console.log("componentDidMount"),this.initCkeditor()}},{key:"deleteOption",value:function(t){this.editorHtml=null,this.props.deleteOption(t.currentTarget.attributes["data-option-id"].value)}},{key:"onChangeChecked",value:function(t){this.updateInputValue(this.editor.getData()),this.props.changeOptionChecked(t.currentTarget.attributes["data-option-id"].value,this.props.datas.checked)}},{key:"initCkeditor",value:function(){if(this.editor)this.editor.setData(this.props.datas.inputValue);else{this.editor=CKEDITOR.replace(this.props.datas.optionId,{toolbar:"Minimal",fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:this.props.imageUploadUrl,height:120});var t=this;this.editor.on("instanceReady",function(){t.editorBody=$("#"+[t.props.datas.optionId]).parent().find("iframe").contents().find("body")}),this.editor.on("change",function(){console.log("change"+t.editor.getData()),setTimeout(function(){t.updateInputValue(t.editor.getData())},100)}),this.editor.on("blur",function(){console.log("blur"+t.editor.getData()),setTimeout(function(){t.updateInputValue(t.editor.getData())},100)})}}},{key:"updateInputValue",value:function(t){console.log(t),this.editorHtml=t,this.props.updateInputValue(this.props.datas.optionId,t)}},{key:"render",value:function(){var e=this,t=this.props.isValidator&&this.props.datas.inputValue.length<=0,i="checkbox";this.props.isRadio&&(i="radio"),this.editorBody&&this.editorHtml!=this.props.datas.inputValue&&this.editorBody.html(this.props.datas.inputValue);var a=Translator.trans("course.question.right_answer_hint");return S.a.createElement("div",{className:"form-group"},S.a.createElement("div",{className:"col-sm-2 control-label"},S.a.createElement("label",{className:"choice-label control-label-required"},this.props.datas.optionLabel)),S.a.createElement("div",{className:"col-sm-8 controls"},S.a.createElement("textarea",{className:"form-control datas-input col-md-8",id:this.props.datas.optionId,defaultValue:this.props.datas.inputValue,name:"choices[]",value:this.props.datas.inputValue,"data-image-upload-url":this.props.imageUploadUrl,"data-image-download-url":this.props.imageDownloadUrl}),S.a.createElement("div",{className:"mtm"},S.a.createElement("label",null,S.a.createElement("input",{type:i,name:"answer[]","data-option-id":this.props.datas.optionId,value:this.props.index,checked:this.props.datas.checked,className:"answer-checkbox",onChange:function(t){return e.onChangeChecked(t)}})," ",a)),S.a.createElement("p",{className:t?"color-danger":"hidden"},Translator.trans("course.question.right_answer_content_hint"))),S.a.createElement("div",{className:"col-sm-2"},S.a.createElement("a",{className:"btn btn-default btn-sm","data-option-id":this.props.datas.optionId,onClick:function(t){return e.deleteOption(t)},href:"javascript:;"},S.a.createElement("i",{className:"glyphicon glyphicon-trash"}))))}}]),a}(b.Component),w=i(5),O=i(14),E=i.n(O),U=i(40);function _(a){return function(){var t,e=f()(a);if(function(){if("undefined"==typeof Reflect||!c.a)return;if(c.a.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(c()(Date,[],function(){})),1}catch(t){return}}()){var i=f()(this).constructor;t=c()(e,arguments,i)}else t=e.apply(this,arguments);return p()(this,t)}}function I(t,e,i,a,n){var r={optionId:Math.random().toString().replace(".",""),optionLabel:Translator.trans("activity.testpaper_manage.question_options")+Object(U.c)(a),inputValue:e,checked:n};i.Options[r.optionId]=0<e.length?1:0,n&&(i.checkedNum+=1),t.push(r)}var N=function(t){g()(o,t);var a=_(o);function o(t){var n;s()(this,o),(n=a.call(this,t)).state={dataSource:[],isValidator:!1},n.validatorDatas={checkedNum:0,Options:{}};var e=n.props.dataSource,r=n.props.dataAnswer;if(0<e.length)e.map(function(t,e){for(var i=!1,a=0;a<r.length;a++)e==r[a]&&(i=!0);I(n.state.dataSource,t,n.validatorDatas,e+1,i)});else for(var i=1;i<=n.props.defaultNum;i++)I(n.state.dataSource,"",n.validatorDatas,i,!1);return n.subscriptionMessage(),console.log(n.validatorOptions),n}return r()(o,[{key:"subscriptionMessage",value:function(){var e=this;E.a.subscribe({channel:"manage-question",topic:"question-create-form-validator-start",callback:function(t){e.validatorOptions(t)}})}},{key:"publishMessage",value:function(t){E.a.publish({channel:"manage-question",topic:"question-create-form-validator-end",data:{isValidator:t}})}},{key:"validatorOptions",value:function(t){var e=0;for(var i in this.setState({isValidator:t.isValidator}),this.validatorDatas.Options)e+=this.validatorDatas.Options[i];e<this.state.dataSource.length?console.log(" validNum is error "):this.validatorDatas.checkedNum<this.props.minCheckedNum?Object(w.a)("danger",Translator.trans("course.question.create.choose_min_answer_num_hint",{minCheckedNum:this.props.minCheckedNum})):(console.log("publishMessage"),this.publishMessage(!0))}},{key:"addOption",value:function(){this.state.dataSource.length>=this.props.maxNum?Object(w.a)("danger",Translator.trans("course.question.create.choose_max_num_hint",{maxNum:this.props.maxNum})):(I(this.state.dataSource,"",this.validatorDatas,this.state.dataSource.length+1,!1),this.setState({dataSource:this.state.dataSource}),console.log({dataSource:this.state.dataSource}),console.log({validatorDatas:this.validatorDatas}))}},{key:"changeOptionChecked",value:function(t,e){var i,a,n,r,o,s;i=this.state.dataSource,a=this.validatorDatas,n=t,r=e,o=this.props.isRadio,s=0,i.map(function(t,e){o?t.optionId!=n||r?r||(i[e].checked=!1):i[e].checked=!0:t.optionId==n&&(i[e].checked=!r),console.log(i[e].checked),i[e].checked&&s++}),console.log(s),a.checkedNum=s,this.setState({dataSource:this.state.dataSource}),this.validatorDatas.checkedNum<=0&&this.publishMessage(!1)}},{key:"deleteOption",value:function(t){this.state.dataSource.length<=this.props.minNum?Object(w.a)("danger",Translator.trans("course.question.create.choose_min_num_hint",{minNum:this.props.minNum})):(function(t,e,i){for(var a=0;a<t.length;a++)t[a].optionId==i?(t[a].checked&&(e.checkedNum=0),t.splice(a,1),console.log(e.Options[i]),console.log(t),delete e.Options[i],a--):t[a].optionLabel=Translator.trans("activity.testpaper_manage.question_options")+Object(U.c)(a+1)}(this.state.dataSource,this.validatorDatas,t),this.setState({dataSource:this.state.dataSource}),console.log({validatorDatas:this.validatorDatas}))}},{key:"updateInputValue",value:function(t,e){var i,a,n;i=this.state.dataSource,this.validatorDatas,a=t,n=e,i.map(function(t,e){t.optionId==a&&(i[e].inputValue=n)}),this.validatorDatas.Options[t]=0<e.length?1:0,e.length<=0&&this.publishMessage(!1),this.setState({dataSource:this.state.dataSource}),console.log(this.state.dataSource)}},{key:"render",value:function(){var i=this,t=Translator.trans("course.question.create_hint");return S.a.createElement("div",{className:"question-options-group"},this.state.dataSource.map(function(t,e){return S.a.createElement(D,{imageUploadUrl:i.props.imageUploadUrl,imageDownloadUrl:i.props.imageDownloadUrl,isRadio:i.props.isRadio,publishMessage:function(t){return i.publishMessage(t)},validatorDatas:i.validatorDatas,isValidator:i.state.isValidator,datas:t,key:e,index:e,deleteOption:function(t){return i.deleteOption(t)},changeOptionChecked:function(t,e){return i.changeOptionChecked(t,e)},updateInputValue:function(t,e){return i.updateInputValue(t,e)}})}),S.a.createElement("div",{className:"form-group"},S.a.createElement("div",{className:"col-md-8 col-md-offset-2"},S.a.createElement("a",{className:"cd-btn cd-btn-success cd-btn-sm pull-right",onClick:function(){return i.addOption()}},t))))}}]),o}(b.Component);function q(a){return function(){var t,e=f()(a);if(function(){if("undefined"==typeof Reflect||!c.a)return;if(c.a.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(c()(Date,[],function(){})),1}catch(t){return}}()){var i=f()(this).constructor;t=c()(e,arguments,i)}else t=e.apply(this,arguments);return p()(this,t)}}N.defaultProps={defaultNum:4,maxNum:10,minNum:2,isRadio:!1,minCheckedNum:1};var T=function(t){g()(a,t);var i=q(a);function a(t){var e;return s()(this,a),(e=i.call(this,t)).isSubmit=!1,e.$submit=null,e.$questionOptions=$("#question-options"),e.dataSource=e.$questionOptions.data("choices"),e.dataAnswer=e.$questionOptions.data("answer"),e.dataSource?(e.dataSource=JSON.parse(e.dataSource),e.dataAnswer=JSON.parse(e.dataAnswer)):(e.dataSource=[],e.dataAnswer=[]),e.imageUploadUrl=e.$questionOptions.data("imageUploadUrl"),e.imageDownloadUrl=e.$questionOptions.data("imageDownloadUrl"),e.initTitleEditor(e.validator),e.initAnalysisEditor(),e.initOptions(),e.subscriptionMessage(),e}return r()(a,[{key:"_initEvent",value:function(){var e=this;this.$form.on("click","[data-role=submit]",function(t){return e.submitForm(t)})}},{key:"submitForm",value:function(t){this.$submit=$(t.currentTarget);var e=this.$submit.data("submission");this.$form.find("[name=submission]").val(e),this.validator.form()&&this.isSubmit&&this.submit(),this.isSubmit||this.publishMessage()}},{key:"submit",value:function(){this.$submit.button("loading"),this.$form.submit()}},{key:"initOptions",value:function(){y.a.render(S.a.createElement(N,{imageUploadUrl:this.imageUploadUrl,imageDownloadUrl:this.imageDownloadUrl,dataSource:this.dataSource,dataAnswer:this.dataAnswer,minCheckedNum:2}),document.getElementById("question-options"))}},{key:"publishMessage",value:function(){console.log("publishMessage"),E.a.publish({channel:"manage-question",topic:"question-create-form-validator-start",data:{isValidator:!0}})}},{key:"subscriptionMessage",value:function(){var e=this;console.log("subscriptionMessage"),E.a.subscribe({channel:"manage-question",topic:"question-create-form-validator-end",callback:function(t){e.isSubmit=t.isValidator,console.log({subscriptionMessage:e.isSubmit}),e.isSubmit&&e.validator.form()&&(console.log("submit by subscriptionMessage"),e.submit())}})}}]),a}(l);function C(a){return function(){var t,e=f()(a);if(function(){if("undefined"==typeof Reflect||!c.a)return;if(c.a.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(c()(Date,[],function(){})),1}catch(t){return}}()){var i=f()(this).constructor;t=c()(e,arguments,i)}else t=e.apply(this,arguments);return p()(this,t)}}var M=function(t){g()(i,t);var e=C(i);function i(){return s()(this,i),e.apply(this,arguments)}return r()(i,[{key:"initOptions",value:function(){y.a.render(S.a.createElement(N,{imageUploadUrl:this.imageUploadUrl,imageDownloadUrl:this.imageDownloadUrl,dataSource:this.dataSource,dataAnswer:this.dataAnswer,isRadio:!0}),document.getElementById("question-options"))}}]),i}(T);function V(a){return function(){var t,e=f()(a);if(function(){if("undefined"==typeof Reflect||!c.a)return;if(c.a.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(c()(Date,[],function(){})),1}catch(t){return}}()){var i=f()(this).constructor;t=c()(e,arguments,i)}else t=e.apply(this,arguments);return p()(this,t)}}var x=function(t){g()(i,t);var e=V(i);function i(){return s()(this,i),e.apply(this,arguments)}return r()(i,[{key:"initOptions",value:function(){y.a.render(S.a.createElement(N,{imageUploadUrl:this.imageUploadUrl,imageDownloadUrl:this.imageDownloadUrl,dataSource:this.dataSource,dataAnswer:this.dataAnswer}),document.getElementById("question-options"))}}]),i}(T);function F(a){return function(){var t,e=f()(a);if(function(){if("undefined"==typeof Reflect||!c.a)return;if(c.a.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(c()(Date,[],function(){})),1}catch(t){return}}()){var i=f()(this).constructor;t=c()(e,arguments,i)}else t=e.apply(this,arguments);return p()(this,t)}}var R=function(t){g()(a,t);var i=F(a);function a(t){var e;return s()(this,a),(e=i.call(this,t)).initTitleEditor(e.validator),e.initAnalysisEditor(),e.$answerField=$('[name="answer[]"]'),e.init(),e}return r()(a,[{key:"initTitleEditor",value:function(){var t=$("#"+this.titleFieldId),e=CKEDITOR.replace(this.titleFieldId,{toolbar:this.titleEditorToolBarName,fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:t.data("imageUploadUrl"),height:t.height()});e.on("change",function(){t.val(e.getData()),console.log(e.getData())}),e.on("blur",function(){t.val(e.getData()),console.log(e.getData())})}},{key:"init",value:function(){this.$answerField.rules("add",{required:!0,messages:{required:Translator.trans("course.question.create.right_answer_required_error_hint")}})}}]),a}(l);function A(a){return function(){var t,e=f()(a);if(function(){if("undefined"==typeof Reflect||!c.a)return;if(c.a.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(c()(Date,[],function(){})),1}catch(t){return}}()){var i=f()(this).constructor;t=c()(e,arguments,i)}else t=e.apply(this,arguments);return p()(this,t)}}jQuery.validator.addMethod("fillCheck",function(t,e){return this.optional(e)||/(\[\[(.+?)\]\])/i.test(t)},Translator.trans("course.question.create.fill_hint"));var j=function(t){g()(a,t);var i=A(a);function a(t){var e;return s()(this,a),(e=i.call(this,t)).titleEditorToolBarName="Question",e.initTitleEditor(e.validator),e.initAnalysisEditor(),e.$titleField=$("#"+e.titleFieldId),e.init(),e}return r()(a,[{key:"init",value:function(){this.$titleField.rules("add",{fillCheck:!0})}}]),a}(l);function P(a){return function(){var t,e=f()(a);if(function(){if("undefined"==typeof Reflect||!c.a)return;if(c.a.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(c()(Date,[],function(){})),1}catch(t){return}}()){var i=f()(this).constructor;t=c()(e,arguments,i)}else t=e.apply(this,arguments);return p()(this,t)}}var B=function(t){g()(a,t);var i=P(a);function a(t){var e;return s()(this,a),(e=i.call(this,t)).initTitleEditor(e.validator),e.initAnalysisEditor(),e.answerFieldId="question-answer-field",e.$answerField=$("#"+e.answerFieldId),e.init(),e}return r()(a,[{key:"init",value:function(){var t=this;this.$answerField.rules("add",{required:!0});var e=CKEDITOR.replace(this.answerFieldId,{toolbar:"Minimal",fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:this.$answerField.data("imageUploadUrl"),height:this.$answerField.height()});e.on("change",function(){t.$answerField.val(e.getData())}),e.on("blur",function(){t.$answerField.val(e.getData())})}}]),a}(l);function L(a){return function(){var t,e=f()(a);if(function(){if("undefined"==typeof Reflect||!c.a)return;if(c.a.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(c()(Date,[],function(){})),1}catch(t){return}}()){var i=f()(this).constructor;t=c()(e,arguments,i)}else t=e.apply(this,arguments);return p()(this,t)}}var z,K=function(t){g()(a,t);var i=L(a);function a(t){var e;return s()(this,a),(e=i.call(this,t)).initTitleEditor(e.validator),e.initAnalysisEditor(),e}return a}(l),H=function(){function t(){s()(this,t)}return r()(t,null,[{key:"getCreator",value:function(t,e){switch(t){case"single_choice":z=new M(e);break;case"uncertain_choice":z=new x(e);break;case"choice":z=new T(e);break;case"determine":z=new R(e);break;case"essay":z=new B(e);break;case"fill":z=new j(e);break;case"material":z=new K(e);break;default:(z=new l(e)).initTitleEditor(),z.initAnalysisEditor()}return z}}]),t}(),J=$('[data-role="question-form"]'),Q=J.find('[name="type"]').val();H.getCreator(Q,J)}});